<!DOCTYPE html>
<html>
  <head>
    <title>Resume Builder Test</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Scripts and whatnot -->
    <script type="text/javascript" src="resume.json"></script>
    <script type="text/javascript" src="mixitup.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.3.5/jspdf.debug.js" integrity="sha384-CchuzHs077vGtfhGYl9Qtc7Vx64rXBXdIAZIPbItbNyWIRTdG0oYAqki3Ry13Yzu" crossorigin="anonymous"></script>
    <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet">
  </head>
  <style type="text/css">
    .mc-project {
      border: 1px solid black;
      margin: 5px;
      background-color: rgb(200, 150, 100);
    }
    .mc-project-content {
      margin: 10px;
      background-color: rgb(200, 100, 100);
    }
    .mc-title {
      font-size: 1.3em;
      margin-right: 10px;
      background-color: rgb(100, 100, 200);
    }
    .mc-title-bar {
      background-color: rgb(120, 180, 220);
      text-align: right;
      height: 100%; 
      overflow: auto;
      font-family: 'Open Sans', sans-serif;
    }
    .mc-date {
      margin-top: 0px;
      background-color: rgb(100, 150, 200);
    }
    .mc-short {
      float: none;
      font-family: 'Open Sans', sans-serif;
    }
    .mc-tools {
      font-size: .7em;
      font-family: 'Open Sans', sans-serif;
      background-color: rgb(100, 150, 100);
      max-width: 150px;
    }
    .mc-roles {
      font-size: .9em;
      font-family: 'Open Sans', sans-serif;
      background-color: rgb(150, 120, 150);
      max-width: 180px;
    }
    .mc-links {
      font-size: .9em;
      font-family: 'Open Sans', sans-serif;
    }
  </style>
  <script type="text/javascript">
    // Store each project
    var arrayProjects = [];
    var allLanguages = new Set();
    var allRoles = new Set();
    var allTools = new Set();

    // When the window is loaded, go ahead and then parse the JSON.
    window.onload = function () { 
      parseResumeJSON(resumeJSON);
      var containerEl = document.querySelector('.container');
      var mixer = mixitup(containerEl);
    }

    // Parses different possible sections for the resume.
    function parseResumeJSON(json) {
      let accumulated = '';
      accumulated += '<div class="container">';

      // For every project, parse content.
      for(let i = 0; i < json.projects.length; i += 1){
        let newItem = parseProject(json.projects[i]);
        arrayProjects[json.projects[i]["name"]] = json.projects[i];
        accumulated += newItem;
      }

      accumulated += '</div>';

      console.log(allLanguages);
      console.log(allRoles);
      console.log(allTools);

      document.getElementById('mc-fill').innerHTML = accumulated;
      populateLanguages();
    }

    function populateLanguages() {
      allLanguages.forEach(function(val) {
        let val1 = `${val}`;
        let val2 = `${val}`;

        if(val1 == 'cpp') val2 = 'C++';
        if(val1 == 'csharp') val2 = 'C#';
        if(val1 == 'htmlcss') val2 = 'HTML/CSS';

        document.getElementById('mc-lang-dropdown').innerHTML 
          = document.getElementById('mc-lang-dropdown').innerHTML 
          + `<button type="button" data-filter=".${val1}">Lang ${val2}</button>`;
      });
    }

    // Parses a specific project from the object. 
    // Returns string of the parsed project in HTML.
    // Note that this is file-specific! A change
    function parseProject(project) {

      let content = `
      <div class="item mix ${get('languages')} mc-project" data-date="${get('date')}">
        <div class="mc-project-content">
          <div class="mc-title-bar">
            <div style="float: left;">
              <span class="mc-title">${get('name')}</span>
            </div>
            <div class="mc-date">
              ${get('date')}
            </div>
          </div>
          <span class="mc-short">${get('short')}</span>
          <p class="mc-links">
            <a href="http://${get('website')}">${get('website')}</a> <a href="${get('download-url')}">${get('download-url') ? 'Download Here' : ''}</a>
          </p>
          <div class="mc-roles">
            ${get('roles')}
          </div>
          <div class="mc-tools">
            ${get('tools')}
          </div>
        </div>
      </div>`

      function get(key) {
        let accumulated = "";

        if(project.hasOwnProperty(key)) {
          switch(key) {
            case 'name': accumulated += parseName(project[key]); break;
            case 'short': accumulated += parseShort(project[key]); break;
            case 'website': accumulated += parseWebsite(project[key]); break;
            case 'download-url': accumulated += parseDownloadURL(project[key]); break;
            case 'date': accumulated += parseDate(project[key]); break;
            case 'roles': accumulated += parseRoles(project[key]); break;
            case 'languages': accumulated += parseLanguages(project[key]); break;
            case 'tools': accumulated += parseTools(project[key]); break;
            case 'actions': accumulated += parseActions(project[key]); break;
            case 'description': accumulated += parseDescription(project[key]); break;
            default:
              console.log('Key "' + key + '" could not be parsed.');
          }
        }

        return accumulated;
      }

      return content;
    }


    function parseName(key_value) {
      return key_value;
    }
    function parseDate(key_value) {
      let accumulated = '';

      for(let i = 0; i <  key_value.length; i += 1) {
        if(i == 0)
          accumulated += key_value[i];
        else
          accumulated += ' ' + key_value[i];
      }

      return accumulated;
    }
    function parseShort(key_value) {
      return key_value;
    }
    function parseWebsite(key_value) {
      return key_value;
    }
    function parseDownloadURL(key_value) {
      return key_value;
    }
    function parseRoles(key_value) {
      let accumulated = '';

      for(let i = 0; i < key_value.length; i += 1) {
        allRoles.add(key_value[i]);
        if(i == 0)
          accumulated += key_value[i];
        else
          accumulated += '<br/>' + key_value[i];
      }

      return accumulated;
    }
    function parseLanguages(key_value) {
      let accumulated = '';
      
      for(let i = 0; i <  key_value.length; i += 1) {
        allLanguages.add(key_value[i]);
        if(i == 0)
          accumulated += key_value[i];
        else
          accumulated += ' ' + key_value[i];
      }

      return accumulated;
    }
    function parseTools(key_value) {
      let accumulated = '';
      
      for(let i = 0; i < key_value.length; i += 1) {
        allTools.add(key_value[i]);
        if(i == 0)
          accumulated += key_value[i];
        else
          accumulated += '<br/>' + key_value[i];
      }

      return accumulated;
    }
    function parseActions(key_value) {
      let accumulated = '';
      
      for(let i = 0; i < key_value.length; i += 1)
        accumulated += '<li>' + key_value[i] + '</li>';

      return accumulated;
    }

    function parseDescription(key_value) {
      return key_value;
    }


  </script>
  <body>

    <button type="button" data-sort="date:asc">Sort Date Ascending</button>
    <button type="button" data-sort="date:desc" class="mixitup-control-active">Sort Date Descending</button>
    <button type="button" data-filter="all">Show All</button>
    
    <div id="mc-lang-dropdown"></div>

    <div id="mc-fill"></div>

  </body>
</html>